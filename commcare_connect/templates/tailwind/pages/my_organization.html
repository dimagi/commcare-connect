{% extends "tailwind/base.html" %}
{% block content %}
{% load crispy_forms_tags %}
<p class="my-5 text-sm max-w-screen-lg mx-auto font-medium text-brand-deep-purple">My Organization</p>

<div
  class="flex flex-col max-w-screen-lg mx-auto gap-2"
  x-data="{
      selectedTab: '{{ request.GET.active_tab|default:'details' }}',
      selectedOption: '',
      isViewPermissionModalOpen: false,
      changeTab(tab) {
        this.selectedTab = tab;
        const url = new URL(window.location);
        url.searchParams.set('active_tab', tab);
        window.history.pushState({}, '', url);
      },
      init() {
        if (this.selectedTab === 'members') {
          htmx.trigger('#invoice_members_container', 'loadMembers');
        }
      }
    }"
  x-init="init()"
>
  {% include "tailwind/components/cards/organization_view_permission.html" %}

  <!-- Tabs -->
  <div class="relative flex items-center justify-between w-full px-4 mx-auto rounded-lg shadow-sm bg-slate-50 h-14">
    <div class="flex h-full px-2 gap-x-8">
      <!-- Details Tab -->
      <div
        @click="changeTab('details'); selectedRows = []"
        class="relative flex items-center h-full text-sm cursor-pointer"
        :class="{
                'text-brand-deep-purple font-medium': selectedTab === 'details',
                'text-gray-500': selectedTab !== 'details'
            }"
      >
        <span>Details</span>
        <div
          class="absolute bottom-0 left-1/2 -translate-x-1/2 w-2/3 h-1.5 bg-brand-mango rounded-t-lg"
          x-show="selectedTab === 'details'"
        ></div>
      </div>

      <!-- Members Tab -->
      <div
        @click="changeTab('members'); selectedRows = []; $nextTick(() => {
                htmx.trigger('#invoice_members_container', 'loadMembers');
            })"
        id="members-tab"
        class="relative flex items-center h-full text-sm cursor-pointer"
        :class="{
                'text-brand-deep-purple font-medium': selectedTab === 'members',
                'text-gray-500': selectedTab !== 'members'
            }"
      >
        <span>Members</span>
        <div
          class="absolute bottom-0 left-1/2 -translate-x-1/2 w-2/3 h-1.5 bg-brand-mango rounded-t-lg"
          x-show="selectedTab === 'members'"
        ></div>
      </div>
    </div>

    <!-- Options -->
    <div x-show="selectedTab === 'members'" class="flex items-center gap-x-4">
      <button type="button" class="button-icon">
        <i class="fa-light fa-pen-line"></i>
      </button>
      <button type="button" class="button-icon">
        <i class="fa-light fa-user-slash"></i>
      </button>
      <button type="button" class="button-icon">
        <i class="fa-light fa-trash"></i>
      </button>
      <button class="button button-md outline-style">Add Members</button>
    </div>
  </div>

  <!-- Tab Content Containers -->
  <div class="w-full">
    <!-- Details Content (Already rendered) -->
    <div x-show="selectedTab === 'details'" class="w-full">
        <h1 class="mt-4 mb-2 text-lg">Organization</h1>
        <form method="post">
          {% csrf_token %}
          {% crispy org_form %}
        </form>
        <h1 class="mt-16 mb-2 text-lg">Members Invite</h1>
        <form method="post">
          {% csrf_token %}
          {% crispy member_form %}
        </form>
        <h1 class="mt-16 text-lg mb-2">Add Credential</h1>
        <form action="{% url 'organization:tw_add_credential' request.org.slug %}" method="post">
          {% csrf_token %}
          {% crispy cred_form %}
        </form>
    </div>

    <!-- Members Content (Loaded via HTMX) -->
    <div
    x-show="selectedTab === 'members'"
    id="invoice_members_container"
    class="w-full"
    hx-get="{% url 'organization:org_member_table' request.org.slug %}"
    hx-swap="innerHTML"
    hx-trigger="loadMembers from:body"
  ></div>
  </div>
</div>
{% endblock content %}
