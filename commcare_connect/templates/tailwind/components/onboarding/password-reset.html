{% load static i18n %}
<form method="post"
      x-data="{
        email: '',
        emailTouched: false,
        emailValid: true,

        validateEmail() {
            this.emailValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email);
            return this.emailValid;
        },

        validateAllFields() {
            this.emailTouched = true;
            return this.validateEmail();
        },

        submitWithValidation() {
            if (this.validateAllFields()) {
                this.$el.dispatchEvent(new CustomEvent('validatedSubmit', { bubbles: true }));
            }
        }
    }"
      class="w-full min-h-[620px] h-fit flex flex-col gap-4"
      hx-post="/a/test-org-managed/opportunity/56/tw/api/password-update/"
      hx-target="#onboarding-container"
      hx-swap="innerHTML"
      hx-trigger="validatedSubmit"
      @submit.prevent="submitWithValidation()">
    {% csrf_token %}
    <h6 class="title text-brand-deep-purple">Password Reset</h6>
    <span class="text-sm text-gray-600">You will receive a password reset link in your email.</span>
    
    <div class="input-group" 
         :class="{'error': !emailValid && emailTouched}">
        <div class="simple-input">
            <input type="email"
                   placeholder="Enter Email ID"
                   required
                   name="email"
                   x-model="email"
                   @blur="emailTouched = true; validateEmail()"
                   @input="if(emailTouched) validateEmail()"/>
            <i class="fa-light fa-envelope"></i>
            <span class="error-icon fa-solid fa-circle-exclamation"></span>
        </div>
        <p class="error-msg">Invalid email format</p>
    </div>

    <div class="flex justify-between items-center">
        <div></div>
        <button class="button button-md outline-style"
                @click="submitWithValidation()">
            <span class="relative z-20">Reset</span>
        </button>
    </div>

    <div class="text-sm text-center mt-auto border-t-gray-200 border-t-2 pt-4 text-gray-600">
        Don't have an account?
        <a href="#"
           class="text-brand-indigo font-medium"
           hx-get="/a/test-org-managed/opportunity/56/tw/api/signup/"
           hx-trigger="click"
           hx-target="#onboarding-container"
           hx-swap="innerHTML">Signup</a>
    </div>
</form>
