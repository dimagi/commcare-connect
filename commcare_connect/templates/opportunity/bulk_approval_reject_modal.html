<div x-cloak
     x-show="{{ modal_name }}"
     x-transition.opacity
     class="modal-backdrop">

  <div @click.away="{{ modal_name }} = false" x-transition class="modal">

    <!-- Header -->
    <div class="header flex justify-between items-center">
      <h2 class="title">{{ title }}</h2>
      <button type="button" @click="{{ modal_name }} = false" class="button-icon" aria-label="Close">
        <i class="fa-solid fa-xmark"></i>
      </button>
    </div>

    <!-- Form -->
   <form
        hx-post="{{ form_action }}"
        hx-swap="none"
        @submit.stop.prevent
        hx-indicator="#spinner"
        @htmx:afterRequest.window="{{ modal_name }} = false"
    >
      {% csrf_token %}

      <!-- Selected IDs -->
      <template x-for="id in selected" :key="id">
        <input type="hidden" name="visit_ids[]" :value="id">
      </template>

      <!-- Body -->
      <div class="py-4">
        {% if textarea_required %}
          <textarea required class="base-textarea" rows="3" name="{{ textarea_name}}"
                    placeholder="{{ textarea_placeholder }}"></textarea>
        {% endif %}

        <div x-show="selected?.length > 0"
             class="mt-3 p-4 rounded-lg border bg-blue-50 border-blue-200">
            <p class="text-sm text-gray-800 leading-relaxed flex flex-wrap items-center gap-2">
                <strong><span x-text="`${selected.length} visit${selected.length !== 1 ? 's' : ''} selected â€”`"></span></strong>
                <span x-show="selectedStatusCounts.approved" class="px-2 py-0.5 text-xs font-medium rounded-full bg-green-100 text-green-800">
                <span x-text="selectedStatusCounts.approved"></span> approved
                </span>
                <span x-show="selectedStatusCounts.rejected" class="px-2 py-0.5 text-xs font-medium rounded-full bg-red-100 text-red-800">
                <span x-text="selectedStatusCounts.rejected"></span> rejected
                </span>
                <span x-show="selectedStatusCounts.pending" class="px-2 py-0.5 text-xs font-medium rounded-full bg-yellow-100 text-yellow-800">
                <span x-text="selectedStatusCounts.pending"></span> pending
                </span>
                <span x-show="selectedStatusCounts.duplicate" class="px-2 py-0.5 text-xs font-medium rounded-full bg-blue-100 text-blue-800">
                <span x-text="selectedStatusCounts.duplicate"></span> duplicate
                </span>
                <span x-show="selectedStatusCounts.overLimit" class="px-2 py-0.5 text-xs font-medium rounded-full bg-orange-100 text-orange-800">
                <span x-text="selectedStatusCounts.overLimit"></span> overlimit
                </span>
            </p>
          <p class="text-xs text-gray-600 mt-1">
            <em>{{ note_text }}</em>
          </p>
        </div>
      </div>

      <div id="spinner" class="text-sm text-blue-600 htmx-indicator text-center mb-3">
          <i class="fa-solid fa-spinner fa-spin mr-1"></i> Submitting...
      </div>

      <!-- Footer -->
      <div class="footer flex justify-end">
        <button @click="{{ modal_name }} = false" type="button" class="button button-md outline-style">
          Close
        </button>
        <button type="submit" class="button button-md {{ submit_btn_class }}">
          {{ submit_btn_text }}
        </button>
      </div>
    </form>
  </div>
</div>
