{% extends "opportunity/invoice_base.html" %}
{% load static %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block top_buttons %}
    {{ block.super }}
    {% if not program_manager %}
    <div
      x-data="{
        open: false,
        openModal() { this.open = true },
        closeModal() { this.open = false }
      }"
      @keydown.escape.window="closeModal()"
      id="invoiceModal"
    >
      <button class="button button-md primary-dark" @click="openModal()">
        {% translate "Create Invoice" %}
      </button>

      <div
        x-cloak
        x-show="open"
        x-transition.opacity
        class="modal-backdrop"
      >
        <div
          @click.away="closeModal()"
          x-show="open"
          x-transition
          class="modal"
          role="dialog"
          aria-labelledby="invoiceModalLabel"
          <div class="modal-content">
            <div class="flex items-center justify-between p-4 border-b">
              <h5 class="text-lg font-medium" id="invoiceModalLabel">{% translate "Create Invoice" %}</h5>
              <button @click="closeModal()" class="button-icon" aria-label="Close" id="invoiceModalClose">
                <i class="fa-light fa-xmark"></i>
              </button>
            </div>

            <form
              hx-post="{% url 'opportunity:invoice_create' org_slug=request.org.slug pk=opportunity.pk %}"
              hx-target="#invoiceForm"
              hx-swap="innerHTML"
            >
              <div class="p-4">
                <div id="invoiceForm">{% crispy form %}</div>
              </div>

              <div class="flex justify-end gap-2 p-4">
                <button
                  type="button"
                  @click="closeModal()"
                  class="button button-md outline-style"
                >
                  {% translate "Close" %}
                </button>

                <button
                  type="submit"
                  class="button button-md primary-dark"
                >
                  {% translate "Save changes" %}
                </button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    {% endif %}
{% endblock top_buttons %}
